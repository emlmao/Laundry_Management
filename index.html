<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speed Wash Laundromat</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
      /* Override WordPress styles without breaking formatting */
      #root input,
      #root textarea,
      #root button,
      #root select {
        font-size: 14px !important;
        line-height: 1.5 !important;
      }
      #root input::placeholder,
      #root textarea::placeholder {
        font-size: 14px !important;
        opacity: 0.5 !important;
      }
      /* Fix table styling */
      #root table,
      #root th,
      #root td {
        font-size: 14px !important;
        padding: 0.5rem !important;
      }
      #root th {
        font-weight: 500 !important;
        text-align: left !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      // ============================================
      // FIREBASE CONFIGURATION
      // ============================================
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBgwxL77VSPbbAUQjkN03zcr7XJH2QJplE",
        authDomain: "laundry-management-4c40c.firebaseapp.com",
        databaseURL:
          "https://laundry-management-4c40c-default-rtdb.firebaseio.com",
        projectId: "laundry-management-4c40c",
        storageBucket: "laundry-management-4c40c.firebasestorage.app",
        messagingSenderId: "335945702733",
        appId: "1:335945702733:web:326321902c7c1519612b04",
        measurementId: "G-18PG7G0JLC",
      };

      // Initialize Firebase
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const database = firebase.database();

      const { useState, useEffect } = React;

      const LaundryManagementApp = () => {
        // State for current entry
        const [currentEntry, setCurrentEntry] = useState({
          employee: "",
          name: "",
          telephone: "",
          weight: "",
          comments: "",
          washersUsed: [],
          dryersUsed: [],
          price: 0,
          paid: "",
          tip: "",
          status: "Pending",
          pickupDateTime: null,
        });

        // State for all laundry records
        const [laundryRecords, setLaundryRecords] = useState([]);
        const [searchTerm, setSearchTerm] = useState("");
        const [activeTab, setActiveTab] = useState("entry");
        const [editingId, setEditingId] = useState(null);
        const [statusFilter, setStatusFilter] = useState("all");
        const [showNameSuggestions, setShowNameSuggestions] = useState(false);
        const [showPhoneSuggestions, setShowPhoneSuggestions] = useState(false);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [adminAuthenticated, setAdminAuthenticated] = useState(false);
        const [passphraseInput, setPassphraseInput] = useState("");
        const [isEditingPrices, setIsEditingPrices] = useState(false);
        const [tempPrices, setTempPrices] = useState({});

        // Machine configuration state
        const [machineConfig, setMachineConfig] = useState({
          washers: { active: [], pricing: {} },
          dryers: { active: [] }
        });
        const [selectedWashersToDelete, setSelectedWashersToDelete] = useState([]);
        const [selectedDryersToDelete, setSelectedDryersToDelete] = useState([]);
        const [newWasherNumber, setNewWasherNumber] = useState("");
        const [newWasherPrice, setNewWasherPrice] = useState("");
        const [newDryerNumber, setNewDryerNumber] = useState("");

        // Employee management state
        const [selectedEmployeesToDelete, setSelectedEmployeesToDelete] = useState([]);
        const [newEmployeeName, setNewEmployeeName] = useState("");

        // Customer database state
        const [customerDatabase, setCustomerDatabase] = useState([]);
        const [customerSearchTerm, setCustomerSearchTerm] = useState("");
        const [selectedCustomersToDelete, setSelectedCustomersToDelete] = useState([]);
        const [newCustomerName, setNewCustomerName] = useState("");
        const [newCustomerPhone, setNewCustomerPhone] = useState("");
        const [editingCustomerId, setEditingCustomerId] = useState(null);
        const [editCustomerName, setEditCustomerName] = useState("");
        const [editCustomerPhone, setEditCustomerPhone] = useState("");

        // Sorting state for records table
        const [dateSortOrder, setDateSortOrder] = useState("desc"); // "asc" or "desc"
        const [statusSortOrder, setStatusSortOrder] = useState("none"); // "none", "asc", "desc"

        // Default machine configuration (fallback values)
        const defaultMachineConfig = {
          washers: {
            active: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],
            pricing: {
              1: 28, 2: 25, 3: 22, 4: 20, 5: 18, 6: 15, 7: 12, 8: 10, 9: 8, 10: 6,
              11: 5, 12: 4, 13: 3, 14: 2, 15: 1, 16: 15, 17: 18, 18: 20, 19: 22,
              20: 25, 21: 28, 22: 11, 23: 9
            }
          },
          dryers: {
            active: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]
          },
          employees: ["John", "Peter", "John & Liz", "Peter & Liz"]
        };

        const [editablePrices, setEditablePrices] = useState(defaultMachineConfig.washers.pricing);
        const [employees, setEmployees] = useState(defaultMachineConfig.employees);
        const statuses = [
          "Pending",
          "Washing",
          "Drying",
          "Done",
          "Picked Up",
        ];

        // ============================================
        // FIREBASE: Load records and pricing in real-time
        // ============================================
        useEffect(() => {
          const recordsRef = database.ref("laundryRecords");
          const machineConfigRef = database.ref("machineConfiguration");
          const customerDatabaseRef = database.ref("customerDatabase");

          // Listen for changes to the records in real-time
          const recordsUnsubscribe = recordsRef.on(
            "value",
            (snapshot) => {
              try {
                const data = snapshot.val();
                if (data) {
                  // Convert Firebase object to array
                  const recordsArray = Object.keys(data).map((key) => ({
                    id: key,
                    ...data[key],
                  }));
                  setLaundryRecords(recordsArray);
                } else {
                  setLaundryRecords([]);
                }
                setLoading(false);
                setError(null);
              } catch (err) {
                console.error("Error loading records:", err);
                setError("Failed to load records. Please refresh the page.");
                setLoading(false);
              }
            },
            (err) => {
              console.error("Firebase error:", err);
              setError(
                "Database connection error. Please check your Firebase configuration."
              );
              setLoading(false);
            }
          );

          // Listen for changes to machine configuration
          const machineConfigUnsubscribe = machineConfigRef.on(
            "value",
            (snapshot) => {
              try {
                const configData = snapshot.val();
                if (configData) {
                  setMachineConfig(configData);
                  setEditablePrices(configData.washers.pricing || {});
                  setEmployees(configData.employees || defaultMachineConfig.employees);
                } else {
                  // If no machine config exists in Firebase, initialize it with defaults
                  database.ref("machineConfiguration").set(defaultMachineConfig);
                  setMachineConfig(defaultMachineConfig);
                  setEditablePrices(defaultMachineConfig.washers.pricing);
                  setEmployees(defaultMachineConfig.employees);
                }
              } catch (err) {
                console.error("Error loading machine configuration:", err);
                // Fall back to default configuration if there's an error
                setMachineConfig(defaultMachineConfig);
                setEditablePrices(defaultMachineConfig.washers.pricing);
                setEmployees(defaultMachineConfig.employees);
              }
            },
            (err) => {
              console.error("Firebase machine config error:", err);
              // Fall back to default configuration if there's an error
              setMachineConfig(defaultMachineConfig);
              setEditablePrices(defaultMachineConfig.washers.pricing);
              setEmployees(defaultMachineConfig.employees);
            }
          );

          // Listen for changes to customer database
          const customerDatabaseUnsubscribe = customerDatabaseRef.on(
            "value",
            (snapshot) => {
              try {
                const data = snapshot.val();
                if (data) {
                  // Convert Firebase object to array
                  const customersArray = Object.keys(data).map((key) => ({
                    id: key,
                    ...data[key],
                  }));
                  setCustomerDatabase(customersArray);
                } else {
                  setCustomerDatabase([]);
                }
              } catch (err) {
                console.error("Error loading customer database:", err);
              }
            },
            (err) => {
              console.error("Firebase customer database error:", err);
            }
          );

          // Cleanup listeners when component unmounts
          return () => {
            recordsRef.off("value", recordsUnsubscribe);
            machineConfigRef.off("value", machineConfigUnsubscribe);
            customerDatabaseRef.off("value", customerDatabaseUnsubscribe);
          };
        }, []);

        // One-time sync of existing customers when both data sets are loaded
        useEffect(() => {
          if (laundryRecords.length > 0 && customerDatabase.length === 0 && !loading) {
            // Only run if we have laundry records but no customer database yet
            syncExistingCustomersToDatabase();
          }
        }, [laundryRecords, customerDatabase, loading]);

        // Calculate total price when washers change
        useEffect(() => {
          const totalPrice = currentEntry.washersUsed.reduce(
            (total, washer) => {
              return total + (editablePrices[washer] || 0);
            },
            0
          );
          setCurrentEntry((prev) => ({ ...prev, price: totalPrice }));
        }, [currentEntry.washersUsed, editablePrices]);

        const handleWasherToggle = (washerNumber) => {
          setCurrentEntry((prev) => ({
            ...prev,
            washersUsed: prev.washersUsed.includes(washerNumber)
              ? prev.washersUsed.filter((w) => w !== washerNumber)
              : [...prev.washersUsed, washerNumber],
          }));
        };

        const handleDryerToggle = (dryerNumber) => {
          setCurrentEntry((prev) => ({
            ...prev,
            dryersUsed: prev.dryersUsed.includes(dryerNumber)
              ? prev.dryersUsed.filter((d) => d !== dryerNumber)
              : [...prev.dryersUsed, dryerNumber],
          }));
        };

        // ============================================
        // FIREBASE: Save new or updated record
        // ============================================
        const handleSubmit = async () => {
          const missingFields = [];
          if (!currentEntry.name) missingFields.push("Customer Name");
          if (!currentEntry.employee) missingFields.push("Employee");

          if (missingFields.length > 0) {
            alert(`Please fill in the following required fields: ${missingFields.join(", ")}`);
            return;
          }

          try {
            const recordData = {
              ...currentEntry,
              dateTime: editingId
                ? laundryRecords.find((r) => r.id === editingId)?.dateTime
                : new Date().toLocaleString(),
              pickup: currentEntry.status === "Picked Up",
              pickupDateTime: currentEntry.pickupDateTime || null,
            };

            if (editingId) {
              // Update existing record in Firebase
              await database.ref(`laundryRecords/${editingId}`).set(recordData);
              alert("Record updated successfully!");
              setEditingId(null);
            } else {
              // Create new record in Firebase
              const newRecordRef = database.ref("laundryRecords").push();
              await newRecordRef.set(recordData);
              alert("Entry saved successfully!");
            }

            // Automatically add customer to database if they don't exist
            await addCustomerToDatabase(currentEntry.name, currentEntry.telephone);

            // Send SMS notification if status is "Done"
            // Note: This is a placeholder - will be replaced with actual Twilio integration
            if (currentEntry.status === "Done" && currentEntry.telephone) {
              sendSMSNotification(currentEntry.telephone, currentEntry.name);
            }

            // Reset form
            setCurrentEntry({
              employee: "",
              name: "",
              telephone: "",
              weight: "",
              comments: "",
              washersUsed: [],
              dryersUsed: [],
              price: 0,
              paid: "",
              tip: "",
              status: "Pending",
              pickupDateTime: null,
            });
          } catch (err) {
            console.error("Error saving record:", err);
            alert("Failed to save record. Please try again.");
          }
        };

        // ============================================
        // PHONE NUMBER FORMATTING
        // ============================================
        const formatPhoneNumber = (phone) => {
          if (!phone) return null;

          // Remove all non-digit characters
          const digitsOnly = phone.replace(/\D/g, '');

          // Handle different input formats
          if (digitsOnly.length === 10) {
            // US number without country code: 4087878371 -> +14087878371
            return '+1' + digitsOnly;
          } else if (digitsOnly.length === 11 && digitsOnly.startsWith('1')) {
            // US number with country code: 14087878371 -> +14087878371
            return '+' + digitsOnly;
          } else if (digitsOnly.length === 11) {
            // Assume US if 11 digits: 14087878371 -> +14087878371
            return '+' + digitsOnly;
          } else if (phone.startsWith('+')) {
            // Already formatted: +14087878371 -> +14087878371
            return phone;
          } else {
            // Unknown format, try as-is with +1
            return '+1' + digitsOnly;
          }
        };

        const sendSMSNotification = async (phone, name) => {
          try {
            // Clean and format the phone number
            const formattedPhone = formatPhoneNumber(phone);

            if (!formattedPhone) {
              alert('Invalid phone number format');
              return;
            }

            const message = `Hello! Your laundry is ready for pickup at Speed Wash Laundromat. Thank you for choosing our service!`;

            console.log(`Sending SMS to: ${formattedPhone} (original: ${phone})`);

            const response = await fetch('/api/send-sms', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                phone: formattedPhone,
                name: name,
                message: message
              })
            });

            const result = await response.json();

            if (result.success) {
              alert(`SMS sent successfully to ${formattedPhone}!`);
            } else {
              console.error('SMS error:', result);
              alert(`Failed to send SMS: ${result.error}`);
            }
          } catch (error) {
            console.error('SMS function error:', error);
            alert('Failed to send SMS. Please check console for details.');
          }
        };

        // ============================================
        // STATUS BUTTON HANDLERS
        // ============================================
        const handleStartWash = async () => {
          const missingFields = [];
          if (!currentEntry.name) missingFields.push("Customer Name");
          if (!currentEntry.employee) missingFields.push("Employee");

          if (missingFields.length > 0) {
            alert(`Please fill in the following required fields: ${missingFields.join(", ")}`);
            return;
          }

          try {
            const recordData = {
              ...currentEntry,
              status: "Washing",
              dateTime: editingId
                ? laundryRecords.find((r) => r.id === editingId)?.dateTime
                : new Date().toLocaleString(),
              pickup: false,
              pickupDateTime: null,
            };

            if (editingId) {
              await database.ref(`laundryRecords/${editingId}`).set(recordData);
            } else {
              const newRecordRef = database.ref("laundryRecords").push();
              await newRecordRef.set(recordData);
            }

            alert("Record updated successfully!");
            setEditingId(null);
            setCurrentEntry({
              employee: "",
              name: "",
              telephone: "",
              weight: "",
              comments: "",
              washersUsed: [],
              dryersUsed: [],
              price: 0,
              paid: "",
              tip: "",
              status: "Pending",
              pickupDateTime: null,
            });
          } catch (err) {
            console.error("Error saving record:", err);
            alert("Failed to save record. Please try again.");
          }
        };

        const handleStartDry = async () => {
          const missingFields = [];
          if (!currentEntry.name) missingFields.push("Customer Name");
          if (!currentEntry.employee) missingFields.push("Employee");

          if (missingFields.length > 0) {
            alert(`Please fill in the following required fields: ${missingFields.join(", ")}`);
            return;
          }

          try {
            const recordData = {
              ...currentEntry,
              status: "Drying",
              dateTime: editingId
                ? laundryRecords.find((r) => r.id === editingId)?.dateTime
                : new Date().toLocaleString(),
              pickup: false,
              pickupDateTime: null,
            };

            if (editingId) {
              await database.ref(`laundryRecords/${editingId}`).set(recordData);
            } else {
              const newRecordRef = database.ref("laundryRecords").push();
              await newRecordRef.set(recordData);
            }

            alert("Record updated successfully!");
            setEditingId(null);
            setCurrentEntry({
              employee: "",
              name: "",
              telephone: "",
              weight: "",
              comments: "",
              washersUsed: [],
              dryersUsed: [],
              price: 0,
              paid: "",
              tip: "",
              status: "Pending",
              pickupDateTime: null,
            });
          } catch (err) {
            console.error("Error saving record:", err);
            alert("Failed to save record. Please try again.");
          }
        };

        const handleDoneNotify = async () => {
          const missingFields = [];
          if (!currentEntry.name) missingFields.push("Customer Name");
          if (!currentEntry.employee) missingFields.push("Employee");

          if (missingFields.length > 0) {
            alert(`Please fill in the following required fields: ${missingFields.join(", ")}`);
            return;
          }

          try {
            const recordData = {
              ...currentEntry,
              status: "Done",
              dateTime: laundryRecords.find((r) => r.id === editingId)?.dateTime,
              pickup: false,
              pickupDateTime: null,
            };

            await database.ref(`laundryRecords/${editingId}`).set(recordData);

            // Send SMS notification
            if (currentEntry.telephone) {
              sendSMSNotification(currentEntry.telephone, currentEntry.name);
            }

            alert("Record updated successfully!");
            setEditingId(null);
            setCurrentEntry({
              employee: "",
              name: "",
              telephone: "",
              weight: "",
              comments: "",
              washersUsed: [],
              dryersUsed: [],
              price: 0,
              paid: "",
              tip: "",
              status: "Pending",
              pickupDateTime: null,
            });
          } catch (err) {
            console.error("Error saving record:", err);
            alert("Failed to save record. Please try again.");
          }
        };

        const handleEdit = (record) => {
          // Ensure arrays exist for washersUsed and dryersUsed
          setCurrentEntry({
            ...record,
            washersUsed: record.washersUsed || [],
            dryersUsed: record.dryersUsed || [],
            weight: record.weight || "",
            comments: record.comments || "",
            paid: record.paid || "",
            tip: record.tip || "",
          });
          setEditingId(record.id);
          setActiveTab("entry");
        };

        // ============================================
        // FIREBASE: Delete record
        // ============================================
        const handleDelete = async (id) => {
          if (confirm("Are you sure you want to delete this record?")) {
            try {
              await database.ref(`laundryRecords/${id}`).remove();
              alert("Record deleted successfully!");
            } catch (err) {
              console.error("Error deleting record:", err);
              alert("Failed to delete record. Please try again.");
            }
          }
        };

        // ============================================
        // FIREBASE: Update record status
        // ============================================
        const handleStatusUpdate = async (recordId, newStatus, currentRecord) => {
          if (!recordId) {
            console.error("No record ID provided");
            alert("Error: No record ID found. Please refresh the page and try again.");
            return;
          }

          try {
            // Create a clean record object without Firebase-specific fields
            const cleanRecord = {
              employee: currentRecord.employee || "",
              name: currentRecord.name || "",
              telephone: currentRecord.telephone || "",
              weight: currentRecord.weight || "",
              comments: currentRecord.comments || "",
              washersUsed: currentRecord.washersUsed || [],
              dryersUsed: currentRecord.dryersUsed || [],
              price: currentRecord.price || 0,
              paid: currentRecord.paid || "",
              tip: currentRecord.tip || "",
              dateTime: currentRecord.dateTime || new Date().toLocaleString(),
              status: newStatus,
              pickup: newStatus === "Picked Up",
              pickupDateTime: newStatus === "Picked Up" && currentRecord.status !== "Picked Up"
                ? new Date().toLocaleString()
                : currentRecord.pickupDateTime || null,
            };

            console.log("Updating record:", recordId, "with data:", cleanRecord);

            // Use update instead of set to be safer
            await database.ref(`laundryRecords/${recordId}`).update(cleanRecord);

            console.log("Status updated successfully");

            // Send SMS notification if status is "Done"
            if (newStatus === "Done" && currentRecord.telephone) {
              sendSMSNotification(currentRecord.telephone, currentRecord.name);
            }
          } catch (err) {
            console.error("Error updating status:", err);
            console.error("Record ID:", recordId);
            console.error("New status:", newStatus);
            alert(`Failed to update status: ${err.message || 'Unknown error'}`);
          }
        };

        // Get unique customers from customer database (replaces getting from records)
        const getUniqueCustomers = () => {
          return customerDatabase.map(customer => ({
            name: customer.name,
            telephone: customer.telephone || ""
          }));
        };

        // Filter customer suggestions based on name input
        const getCustomerSuggestions = () => {
          if (!currentEntry.name || currentEntry.name.length === 0) return [];
          const uniqueCustomers = getUniqueCustomers();
          return uniqueCustomers.filter((customer) =>
            customer.name
              .toLowerCase()
              .includes(currentEntry.name.toLowerCase())
          );
        };

        // Filter customer suggestions based on phone input
        const getPhoneSuggestions = () => {
          if (!currentEntry.telephone || currentEntry.telephone.length === 0)
            return [];
          const uniqueCustomers = getUniqueCustomers();
          return uniqueCustomers.filter(
            (customer) =>
              customer.telephone &&
              customer.telephone.includes(currentEntry.telephone)
          );
        };

        const handleNameChange = (e) => {
          setCurrentEntry((prev) => ({ ...prev, name: e.target.value }));
          setShowNameSuggestions(true);
        };

        const handlePhoneChange = (e) => {
          setCurrentEntry((prev) => ({ ...prev, telephone: e.target.value }));
          setShowPhoneSuggestions(true);
        };

        const handleNameSelect = (customer) => {
          setCurrentEntry((prev) => ({
            ...prev,
            name: customer.name,
            telephone: customer.telephone || "",
          }));
          setShowNameSuggestions(false);
        };

        const handlePhoneSelect = (customer) => {
          setCurrentEntry((prev) => ({
            ...prev,
            name: customer.name,
            telephone: customer.telephone || "",
          }));
          setShowPhoneSuggestions(false);
        };

        const formatWashers = (washers) => {
          return washers.sort((a, b) => a - b).join(", ");
        };

        const formatMachines = (washers, dryers) => {
          const washerStr = washers
            .sort((a, b) => a - b)
            .map((w) => `W${w}`)
            .join(", ");
          const dryerStr = dryers
            .sort((a, b) => a - b)
            .map((d) => `D${d}`)
            .join(", ");
          const parts = [washerStr, dryerStr].filter((s) => s.length > 0);
          return parts.join(", ") || "None";
        };

        const filteredRecords = laundryRecords
          .filter((record) => {
            // Search filter
            const machineString = formatMachines(
              record.washersUsed || [],
              record.dryersUsed || []
            ).toLowerCase();
            const matchesSearch =
              searchTerm === "" ||
              record.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
              record.telephone.includes(searchTerm) ||
              record.status.toLowerCase().includes(searchTerm.toLowerCase()) ||
              machineString.includes(searchTerm.toLowerCase());

            // Status filter
            const matchesStatus =
              statusFilter === "all" || record.status === statusFilter;

            return matchesSearch && matchesStatus;
          })
          .sort((a, b) => {
            // Define status order for workflow
            const statusOrder = {
              "Pending": 0,
              "Washing": 1,
              "Drying": 2,
              "Done": 3,
              "Picked Up": 4
            };

            // If status sorting is active, sort by status first
            if (statusSortOrder !== "none") {
              const statusA = statusOrder[a.status] !== undefined ? statusOrder[a.status] : 999;
              const statusB = statusOrder[b.status] !== undefined ? statusOrder[b.status] : 999;

              if (statusSortOrder === "asc") {
                // Pending -> Washing -> Drying -> Done -> Picked Up
                if (statusA !== statusB) {
                  return statusA - statusB;
                }
              } else { // desc
                // Picked Up -> Done -> Drying -> Washing -> Pending
                if (statusA !== statusB) {
                  return statusB - statusA;
                }
              }

              // If statuses are the same, fall back to date sorting
              const dateA = new Date(a.dateTime);
              const dateB = new Date(b.dateTime);
              return dateB - dateA; // Most recent first for same status
            }

            // Default: Sort by actual dateTime based on current sort order
            const dateA = new Date(a.dateTime);
            const dateB = new Date(b.dateTime);

            if (dateSortOrder === "desc") {
              return dateB - dateA; // Most recent first
            } else {
              return dateA - dateB; // Oldest first
            }
          });

        const downloadCSV = () => {
          const headers = [
            "Date & Time",
            "Employee",
            "Name",
            "Telephone",
            "Weight",
            "Comments",
            "Machines",
            "Price",
            "Paid",
            "Tip",
            "Status",
            "Pickup Date/Time",
          ];
          const csvData = filteredRecords.map((record) => [
            record.dateTime,
            record.employee,
            record.name,
            record.telephone,
            record.weight || "",
            record.comments || "",
            formatMachines(record.washersUsed || [], record.dryersUsed || []),
            `$${record.price}`,
            `$${record.paid || 0}`,
            `$${record.tip || 0}`,
            record.status,
            record.pickupDateTime || "-",
          ]);

          const csvContent = [headers, ...csvData]
            .map((row) => row.map((field) => `"${field}"`).join(","))
            .join("\n");

          const blob = new Blob([csvContent], { type: "text/csv" });
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `laundry-records-${
            new Date().toISOString().split("T")[0]
          }.csv`;
          link.click();
          window.URL.revokeObjectURL(url);
        };

        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        const handlePassphraseSubmit = () => {
          if (passphraseInput === "helloworld123") {
            setAdminAuthenticated(true);
            setPassphraseInput("");
          } else {
            alert("Incorrect passphrase. Please try again.");
            setPassphraseInput("");
          }
        };

        const handlePassphraseKeyPress = (e) => {
          if (e.key === "Enter") {
            handlePassphraseSubmit();
          }
        };

        const startEditingPrices = () => {
          setTempPrices({ ...editablePrices });
          setIsEditingPrices(true);
        };

        const cancelEditingPrices = () => {
          setTempPrices({});
          setIsEditingPrices(false);
        };

        const savePriceChanges = async () => {
          // Validate all prices are positive numbers
          const invalidPrices = Object.entries(tempPrices).filter(
            ([, price]) => isNaN(price) || parseFloat(price) < 0
          );

          if (invalidPrices.length > 0) {
            alert("Please enter valid positive numbers for all prices.");
            return;
          }

          try {
            // Convert string values to numbers
            const numericPrices = {};
            Object.entries(tempPrices).forEach(([washer, price]) => {
              numericPrices[washer] = parseFloat(price);
            });

            // Update machine configuration with new pricing
            const updatedConfig = {
              ...machineConfig,
              washers: {
                ...machineConfig.washers,
                pricing: numericPrices
              },
              employees: employees
            };

            // Save to Firebase
            await database.ref("machineConfiguration").set(updatedConfig);

            // Update local state (Firebase listener will also update this)
            setEditablePrices(numericPrices);
            setTempPrices({});
            setIsEditingPrices(false);
            alert("Prices updated successfully and saved to database!");
          } catch (err) {
            console.error("Error saving prices:", err);
            alert("Failed to save prices. Please try again.");
          }
        };

        // ============================================
        // MACHINE MANAGEMENT FUNCTIONS
        // ============================================
        const addWasher = async () => {
          const washerNum = parseInt(newWasherNumber);
          const price = parseFloat(newWasherPrice);

          if (isNaN(washerNum) || washerNum <= 0) {
            alert("Please enter a valid positive washer number.");
            return;
          }

          if (isNaN(price) || price < 0) {
            alert("Please enter a valid price (0 or greater).");
            return;
          }

          if (machineConfig.washers.active.includes(washerNum)) {
            alert(`Washer #${washerNum} already exists.`);
            return;
          }

          try {
            const updatedConfig = {
              ...machineConfig,
              washers: {
                active: [...machineConfig.washers.active, washerNum].sort((a, b) => a - b),
                pricing: { ...machineConfig.washers.pricing, [washerNum]: price }
              }
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setNewWasherNumber("");
            setNewWasherPrice("");
            alert(`Washer #${washerNum} added successfully!`);
          } catch (err) {
            console.error("Error adding washer:", err);
            alert("Failed to add washer. Please try again.");
          }
        };

        const addDryer = async () => {
          const dryerNum = parseInt(newDryerNumber);

          if (isNaN(dryerNum) || dryerNum <= 0) {
            alert("Please enter a valid positive dryer number.");
            return;
          }

          if (machineConfig.dryers.active.includes(dryerNum)) {
            alert(`Dryer #${dryerNum} already exists.`);
            return;
          }

          try {
            const updatedConfig = {
              ...machineConfig,
              dryers: {
                active: [...machineConfig.dryers.active, dryerNum].sort((a, b) => a - b)
              }
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setNewDryerNumber("");
            alert(`Dryer #${dryerNum} added successfully!`);
          } catch (err) {
            console.error("Error adding dryer:", err);
            alert("Failed to add dryer. Please try again.");
          }
        };

        const deleteSelectedWashers = async () => {
          if (selectedWashersToDelete.length === 0) {
            alert("Please select washers to delete.");
            return;
          }

          if (!confirm(`Are you sure you want to delete washers: ${selectedWashersToDelete.join(", ")}?`)) {
            return;
          }

          try {
            const remainingWashers = machineConfig.washers.active.filter(
              w => !selectedWashersToDelete.includes(w)
            );

            const updatedPricing = { ...machineConfig.washers.pricing };
            selectedWashersToDelete.forEach(w => delete updatedPricing[w]);

            const updatedConfig = {
              ...machineConfig,
              washers: {
                active: remainingWashers,
                pricing: updatedPricing
              }
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setSelectedWashersToDelete([]);
            alert("Selected washers deleted successfully!");
          } catch (err) {
            console.error("Error deleting washers:", err);
            alert("Failed to delete washers. Please try again.");
          }
        };

        const deleteSelectedDryers = async () => {
          if (selectedDryersToDelete.length === 0) {
            alert("Please select dryers to delete.");
            return;
          }

          if (!confirm(`Are you sure you want to delete dryers: ${selectedDryersToDelete.join(", ")}?`)) {
            return;
          }

          try {
            const remainingDryers = machineConfig.dryers.active.filter(
              d => !selectedDryersToDelete.includes(d)
            );

            const updatedConfig = {
              ...machineConfig,
              dryers: {
                active: remainingDryers
              }
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setSelectedDryersToDelete([]);
            alert("Selected dryers deleted successfully!");
          } catch (err) {
            console.error("Error deleting dryers:", err);
            alert("Failed to delete dryers. Please try again.");
          }
        };

        const toggleWasherSelection = (washerNum) => {
          setSelectedWashersToDelete(prev =>
            prev.includes(washerNum)
              ? prev.filter(w => w !== washerNum)
              : [...prev, washerNum]
          );
        };

        const toggleDryerSelection = (dryerNum) => {
          setSelectedDryersToDelete(prev =>
            prev.includes(dryerNum)
              ? prev.filter(d => d !== dryerNum)
              : [...prev, dryerNum]
          );
        };

        // ============================================
        // EMPLOYEE MANAGEMENT FUNCTIONS
        // ============================================
        const addEmployee = async () => {
          const employeeName = newEmployeeName.trim();

          if (!employeeName) {
            alert("Please enter an employee name.");
            return;
          }

          if (employees.includes(employeeName)) {
            alert(`Employee "${employeeName}" already exists.`);
            return;
          }

          try {
            const updatedEmployees = [...employees, employeeName];
            const updatedConfig = {
              ...machineConfig,
              employees: updatedEmployees
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setNewEmployeeName("");
            alert(`Employee "${employeeName}" added successfully!`);
          } catch (err) {
            console.error("Error adding employee:", err);
            alert("Failed to add employee. Please try again.");
          }
        };

        const deleteSelectedEmployees = async () => {
          if (selectedEmployeesToDelete.length === 0) {
            alert("Please select employees to delete.");
            return;
          }

          if (!confirm(`Are you sure you want to delete employees: ${selectedEmployeesToDelete.join(", ")}?`)) {
            return;
          }

          try {
            const remainingEmployees = employees.filter(
              e => !selectedEmployeesToDelete.includes(e)
            );

            if (remainingEmployees.length === 0) {
              alert("Cannot delete all employees. At least one employee must remain.");
              return;
            }

            const updatedConfig = {
              ...machineConfig,
              employees: remainingEmployees
            };

            await database.ref("machineConfiguration").set(updatedConfig);
            setSelectedEmployeesToDelete([]);
            alert("Selected employees deleted successfully!");
          } catch (err) {
            console.error("Error deleting employees:", err);
            alert("Failed to delete employees. Please try again.");
          }
        };

        const toggleEmployeeSelection = (employeeName) => {
          setSelectedEmployeesToDelete(prev =>
            prev.includes(employeeName)
              ? prev.filter(e => e !== employeeName)
              : [...prev, employeeName]
          );
        };

        // ============================================
        // CUSTOMER DATABASE MANAGEMENT FUNCTIONS
        // ============================================

        // Helper function to add customer to database (used by both manual entry and automatic from laundry records)
        const addCustomerToDatabase = async (name, telephone = "") => {
          const customerName = name.trim();
          const customerPhone = (telephone || "").trim();

          if (!customerName) {
            return; // Skip if no name provided
          }

          try {
            // Check in Firebase directly to avoid state timing issues
            const snapshot = await database.ref("customerDatabase").once("value");
            const existingCustomers = snapshot.val() || {};

            // Check if customer already exists (same name and phone combination)
            const isDuplicate = Object.values(existingCustomers).some(customer =>
              customer.name.toLowerCase() === customerName.toLowerCase() &&
              (customer.telephone || "").trim() === customerPhone
            );

            if (isDuplicate) {
              return; // Customer already exists, skip
            }

            const customerData = {
              name: customerName,
              telephone: customerPhone
            };

            const newCustomerRef = database.ref("customerDatabase").push();
            await newCustomerRef.set(customerData);
          } catch (err) {
            console.error("Error auto-adding customer to database:", err);
          }
        };

        // Clean up duplicate customers in database
        const cleanupDuplicateCustomers = async () => {
          try {
            const snapshot = await database.ref("customerDatabase").once("value");
            const customers = snapshot.val() || {};

            const uniqueCustomers = new Map();
            const duplicateIds = [];

            // Find duplicates
            Object.entries(customers).forEach(([id, customer]) => {
              const key = `${customer.name.toLowerCase()}_${(customer.telephone || "").trim()}`;

              if (uniqueCustomers.has(key)) {
                // This is a duplicate, mark for deletion
                duplicateIds.push(id);
              } else {
                // This is the first occurrence, keep it
                uniqueCustomers.set(key, { id, ...customer });
              }
            });

            // Delete duplicates
            if (duplicateIds.length > 0) {
              const deletePromises = duplicateIds.map(id =>
                database.ref(`customerDatabase/${id}`).remove()
              );
              await Promise.all(deletePromises);
            }
          } catch (err) {
            console.error("Error cleaning up duplicates:", err);
          }
        };

        // Sync existing laundry records to customer database
        const syncExistingCustomersToDatabase = async () => {
          const existingCustomers = new Map();

          // Get unique customers from laundry records
          laundryRecords.forEach((record) => {
            if (record.name) {
              const key = `${record.name.toLowerCase()}_${(record.telephone || "").trim()}`;
              if (!existingCustomers.has(key)) {
                existingCustomers.set(key, {
                  name: record.name,
                  telephone: (record.telephone || "").trim(),
                });
              }
            }
          });

          // Add each unique customer to database
          const addPromises = Array.from(existingCustomers.values()).map(customer =>
            addCustomerToDatabase(customer.name, customer.telephone)
          );

          try {
            await Promise.all(addPromises);
            // Clean up any duplicates that might have been created
            setTimeout(() => cleanupDuplicateCustomers(), 2000);
          } catch (err) {
            console.error("Error syncing existing customers:", err);
          }
        };

        const addCustomer = async () => {
          const customerName = newCustomerName.trim();
          const customerPhone = newCustomerPhone.trim();

          if (!customerName) {
            alert("Please enter a customer name.");
            return;
          }

          // Check if customer already exists (same name and phone combination)
          const existingCustomer = customerDatabase.find(
            customer => customer.name.toLowerCase() === customerName.toLowerCase() &&
                       customer.telephone === customerPhone
          );

          if (existingCustomer) {
            alert(`Customer "${customerName}" with phone "${customerPhone}" already exists.`);
            return;
          }

          try {
            const customerData = {
              name: customerName,
              telephone: customerPhone
            };

            const newCustomerRef = database.ref("customerDatabase").push();
            await newCustomerRef.set(customerData);

            setNewCustomerName("");
            setNewCustomerPhone("");
            alert(`Customer "${customerName}" added successfully!`);
          } catch (err) {
            console.error("Error adding customer:", err);
            alert("Failed to add customer. Please try again.");
          }
        };

        const startEditingCustomer = (customer) => {
          setEditingCustomerId(customer.id);
          setEditCustomerName(customer.name);
          setEditCustomerPhone(customer.telephone);
        };

        const cancelEditingCustomer = () => {
          setEditingCustomerId(null);
          setEditCustomerName("");
          setEditCustomerPhone("");
        };

        const saveCustomerChanges = async () => {
          const customerName = editCustomerName.trim();
          const customerPhone = editCustomerPhone.trim();

          if (!customerName) {
            alert("Please enter a customer name.");
            return;
          }

          // Check if another customer already exists with same name and phone combination
          const existingCustomer = customerDatabase.find(
            customer => customer.id !== editingCustomerId &&
                       customer.name.toLowerCase() === customerName.toLowerCase() &&
                       customer.telephone === customerPhone
          );

          if (existingCustomer) {
            alert(`Another customer "${customerName}" with phone "${customerPhone}" already exists.`);
            return;
          }

          try {
            const customerData = {
              name: customerName,
              telephone: customerPhone
            };

            await database.ref(`customerDatabase/${editingCustomerId}`).set(customerData);

            cancelEditingCustomer();
            alert(`Customer updated successfully!`);
          } catch (err) {
            console.error("Error updating customer:", err);
            alert("Failed to update customer. Please try again.");
          }
        };

        const deleteSelectedCustomers = async () => {
          if (selectedCustomersToDelete.length === 0) {
            alert("Please select customers to delete.");
            return;
          }

          const customerNames = selectedCustomersToDelete.map(id => {
            const customer = customerDatabase.find(c => c.id === id);
            return customer ? `${customer.name} (${customer.telephone})` : id;
          });

          if (!confirm(`Are you sure you want to delete these customers: ${customerNames.join(", ")}?`)) {
            return;
          }

          try {
            // Delete each selected customer
            const deletePromises = selectedCustomersToDelete.map(customerId =>
              database.ref(`customerDatabase/${customerId}`).remove()
            );

            await Promise.all(deletePromises);
            setSelectedCustomersToDelete([]);
            alert("Selected customers deleted successfully!");
          } catch (err) {
            console.error("Error deleting customers:", err);
            alert("Failed to delete customers. Please try again.");
          }
        };

        const toggleCustomerSelection = (customerId) => {
          setSelectedCustomersToDelete(prev =>
            prev.includes(customerId)
              ? prev.filter(id => id !== customerId)
              : [...prev, customerId]
          );
        };

        // Filter customers based on search term and sort alphabetically
        const getFilteredCustomers = () => {
          let filteredCustomers;

          if (!customerSearchTerm) {
            filteredCustomers = customerDatabase;
          } else {
            filteredCustomers = customerDatabase.filter(customer =>
              customer.name.toLowerCase().includes(customerSearchTerm.toLowerCase()) ||
              (customer.telephone && customer.telephone.includes(customerSearchTerm))
            );
          }

          // Sort alphabetically by name (case-insensitive)
          return filteredCustomers.sort((a, b) =>
            a.name.toLowerCase().localeCompare(b.name.toLowerCase())
          );
        };


        const handlePriceChange = (washerNumber, newPrice) => {
          setTempPrices((prev) => ({
            ...prev,
            [washerNumber]: newPrice,
          }));
        };

        // ============================================
        // LOADING & ERROR STATES
        // ============================================
        if (loading) {
          return (
            <div className="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
              <div className="text-center">
                <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"></div>
                <p className="text-gray-600 text-lg">
                  Loading laundry records...
                </p>
              </div>
            </div>
          );
        }

        if (error) {
          return (
            <div className="min-h-screen bg-gray-100 p-4 flex items-center justify-center">
              <div className="bg-red-50 border-2 border-red-500 rounded-lg p-8 max-w-md">
                <h2 className="text-2xl font-bold text-red-800 mb-4">
                  Connection Error
                </h2>
                <p className="text-red-700 mb-4">{error}</p>
                <button
                  onClick={() => window.location.reload()}
                  className="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md font-medium transition-colors"
                >
                  Reload Page
                </button>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen bg-gray-100 p-4">
            <div className="max-w-screen-xl mx-auto">
              <h1 className="text-3xl font-bold text-center mb-6 text-gray-800">
                Speed Wash Laundromat
              </h1>

              {/* Tab Navigation */}
              <div className="flex mb-6 bg-white rounded-lg shadow-sm">
                <button
                  onClick={() => setActiveTab("entry")}
                  className={`flex-1 py-3 px-6 text-center font-medium transition-colors ${
                    activeTab === "entry"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-50 text-gray-600 hover:bg-gray-100"
                  } ${activeTab === "admin" ? "" : "rounded-l-lg"}`}
                >
                  {editingId ? "Edit Entry" : "New Entry"}
                </button>
                <button
                  onClick={() => setActiveTab("records")}
                  className={`flex-1 py-3 px-6 text-center font-medium transition-colors ${
                    activeTab === "records"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-50 text-gray-600 hover:bg-gray-100"
                  }`}
                >
                  Records & History
                </button>
                <button
                  onClick={() => setActiveTab("admin")}
                  className={`flex-1 py-3 px-6 text-center font-medium rounded-r-lg transition-colors ${
                    activeTab === "admin"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-50 text-gray-600 hover:bg-gray-100"
                  }`}
                >
                  Admin
                </button>
              </div>

              {activeTab === "entry" && (
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-semibold mb-4">
                    {editingId ? "Edit Laundry Entry" : "New Laundry Entry"}
                  </h2>

                  {/* Employee Selection */}
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Employee (Can only select one option)
                    </label>
                    <div className="flex gap-4 flex-wrap">
                      {employees.map((employee) => (
                        <label key={employee} className="flex items-center">
                          <input
                            type="radio"
                            name="employee"
                            value={employee}
                            checked={currentEntry.employee === employee}
                            onChange={(e) =>
                              setCurrentEntry((prev) => ({
                                ...prev,
                                employee: e.target.value,
                              }))
                            }
                            className="mr-2"
                          />
                          <span className="text-sm">{employee}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  {/* Customer Info */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div className="relative">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Name
                      </label>
                      <input
                        type="text"
                        value={currentEntry.name}
                        onChange={handleNameChange}
                        onFocus={() => setShowNameSuggestions(true)}
                        onBlur={() =>
                          setTimeout(() => setShowNameSuggestions(false), 200)
                        }
                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Customer name"
                      />
                      {showNameSuggestions &&
                        getCustomerSuggestions().length > 0 && (
                          <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto">
                            {getCustomerSuggestions().map((customer, index) => (
                              <div
                                key={index}
                                onClick={() => handleNameSelect(customer)}
                                className="p-2 hover:bg-blue-100 cursor-pointer text-sm"
                              >
                                <div className="font-medium">
                                  {customer.name}
                                </div>
                                {customer.telephone && (
                                  <div className="text-gray-600 text-xs">
                                    {customer.telephone}
                                  </div>
                                )}
                              </div>
                            ))}
                          </div>
                        )}
                    </div>
                    <div className="relative">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Telephone (optional)
                      </label>
                      <input
                        type="tel"
                        value={currentEntry.telephone}
                        onChange={handlePhoneChange}
                        onFocus={() => setShowPhoneSuggestions(true)}
                        onBlur={() =>
                          setTimeout(() => setShowPhoneSuggestions(false), 200)
                        }
                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Phone number"
                      />
                      {showPhoneSuggestions &&
                        getPhoneSuggestions().length > 0 && (
                          <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto">
                            {getPhoneSuggestions().map((customer, index) => (
                              <div
                                key={index}
                                onClick={() => handlePhoneSelect(customer)}
                                className="p-2 hover:bg-blue-100 cursor-pointer text-sm"
                              >
                                <div className="font-medium">
                                  {customer.telephone}
                                </div>
                                <div className="text-gray-600 text-xs">
                                  {customer.name}
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Weight (lbs) (optional)
                      </label>
                      <input
                        type="number"
                        value={currentEntry.weight}
                        onChange={(e) =>
                          setCurrentEntry((prev) => ({
                            ...prev,
                            weight: e.target.value,
                          }))
                        }
                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Weight in pounds"
                      />
                    </div>
                  </div>

                  {/* Comments */}
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Comments (optional)
                    </label>
                    <textarea
                      value={currentEntry.comments}
                      onChange={(e) =>
                        setCurrentEntry((prev) => ({
                          ...prev,
                          comments: e.target.value,
                        }))
                      }
                      className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Additional notes or special instructions"
                      rows="3"
                    />
                  </div>

                  {/* Washers Used */}
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Washers Used (Multiple selection. Each option has price)
                    </label>
                    <div className="flex flex-wrap gap-1 mb-2">
                      {machineConfig.washers.active.map((washer) => (
                        <button
                          key={washer}
                          type="button"
                          onClick={() => handleWasherToggle(washer)}
                          className={`h-8 w-10 rounded border text-xs font-medium transition-colors ${
                            currentEntry.washersUsed.includes(washer)
                              ? "bg-blue-300 text-blue-800 border-blue-300"
                              : "bg-white text-gray-700 border-gray-300 hover:border-gray-400"
                          }`}
                        >
                          W{washer}
                        </button>
                      ))}
                    </div>
                    <div className="text-sm text-gray-600">
                      Selected washers:{" "}
                      {formatWashers(currentEntry.washersUsed) || "None"}
                      <br />
                      Individual prices:{" "}
                      {currentEntry.washersUsed
                        .map((w) => `#${w} = $${editablePrices[w]}`)
                        .join(", ")}
                    </div>
                    {!editingId && (
                      <div className="mt-3">
                        <button
                          onClick={handleStartWash}
                          className="bg-blue-300 hover:bg-blue-400 text-blue-800 px-4 py-2 rounded-md font-medium transition-colors"
                        >
                          Start Wash
                        </button>
                      </div>
                    )}
                  </div>

                  {/* Dryers Used */}
                  <div className="mb-6">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Dryers Used (Multiple selection. No price)
                    </label>
                    <div className="flex flex-wrap gap-1 mb-2">
                      {machineConfig.dryers.active.map((dryer) => (
                        <button
                          key={dryer}
                          type="button"
                          onClick={() => handleDryerToggle(dryer)}
                          className={`h-8 w-10 rounded border text-xs font-medium transition-colors ${
                            currentEntry.dryersUsed.includes(dryer)
                              ? "bg-green-300 text-green-800 border-green-300"
                              : "bg-white text-gray-700 border-gray-300 hover:border-gray-400"
                          }`}
                        >
                          D{dryer}
                        </button>
                      ))}
                    </div>
                    <div className="text-sm text-gray-600">
                      Selected dryers:{" "}
                      {formatWashers(currentEntry.dryersUsed) || "None"}
                    </div>
                    {!editingId && (
                      <div className="mt-3">
                        <button
                          onClick={handleStartDry}
                          className="bg-green-300 hover:bg-green-400 text-green-800 px-4 py-2 rounded-md font-medium transition-colors"
                        >
                          Start Dry
                        </button>
                      </div>
                    )}
                  </div>


                  {/* Price, Paid, Tip */}
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Price
                      </label>
                      <input
                        type="number"
                        value={currentEntry.price}
                        readOnly
                        className="w-full p-2 border border-gray-300 rounded-md bg-gray-50"
                        placeholder="Auto-calculated"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Paid
                      </label>
                      <input
                        type="number"
                        value={currentEntry.paid}
                        onChange={(e) =>
                          setCurrentEntry((prev) => ({
                            ...prev,
                            paid: e.target.value,
                          }))
                        }
                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Amount paid"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Tip
                      </label>
                      <input
                        type="number"
                        value={currentEntry.tip}
                        onChange={(e) =>
                          setCurrentEntry((prev) => ({
                            ...prev,
                            tip: e.target.value,
                          }))
                        }
                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Tip amount"
                      />
                    </div>
                  </div>


                  {/* Submit Button */}
                  <div className="space-y-4">
                    {editingId && (
                      <div className="flex gap-4">
                        <button
                          onClick={handleDoneNotify}
                          className="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-md font-medium transition-colors"
                        >
                          Done - Notify Customer
                        </button>
                      </div>
                    )}
                    <div className="flex gap-4">
                      <button
                        onClick={handleSubmit}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md font-medium transition-colors"
                      >
                        {editingId ? "Update Entry" : "Save Entry"}
                      </button>
                      {editingId && (
                        <button
                          onClick={() => {
                            setEditingId(null);
                            setCurrentEntry({
                              employee: "",
                              name: "",
                              telephone: "",
                              weight: "",
                              comments: "",
                              washersUsed: [],
                              dryersUsed: [],
                              price: 0,
                              paid: "",
                              tip: "",
                              status: "Pending",
                              pickupDateTime: null,
                            });
                          }}
                          className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-md font-medium transition-colors"
                        >
                          Cancel Edit
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              )}

              {activeTab === "records" && (
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <div className="mb-6">
                    <h2 className="text-xl font-semibold mb-4">
                      Laundry Records & History
                    </h2>

                    {/* Search Bar */}
                    <div className="mb-4">
                      <div className="flex items-center gap-2">
                        <span className="text-gray-400"></span>
                        <input
                          type="text"
                          placeholder="Search by name, phone, status, or machine (W1, D5, etc.)..."
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                    </div>

                    {/* Filters and Download */}
                    <div className="flex flex-wrap gap-4 items-center justify-between">
                      {/* Status Filter */}
                      <div className="flex items-center gap-2">
                        <label className="text-sm font-medium text-gray-700">
                          Status:
                        </label>
                        <select
                          value={statusFilter}
                          onChange={(e) => setStatusFilter(e.target.value)}
                          className="p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                          <option value="all">All Statuses</option>
                          {statuses.map((status) => (
                            <option key={status} value={status}>
                              {status}
                            </option>
                          ))}
                        </select>
                      </div>

                      {/* Download Button */}
                      <button
                        onClick={downloadCSV}
                        className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-medium transition-colors flex items-center gap-2"
                      >
                         Download CSV
                      </button>
                    </div>
                  </div>

                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse border border-gray-300">
                      <thead>
                        <tr className="bg-gray-800 text-white">
                          <th
                            className="border border-gray-300 p-2 text-left cursor-pointer hover:bg-gray-700 transition-colors select-none"
                            onClick={() => {
                              setDateSortOrder(dateSortOrder === "desc" ? "asc" : "desc");
                              setStatusSortOrder("none"); // Reset status sort when clicking date
                            }}
                            title="Click to sort by date"
                          >
                            <div className="flex items-center gap-1">
                              Date & Time
                              <span className="text-sm">
                                {statusSortOrder === "none" ? (dateSortOrder === "desc" ? "" : "") : ""}
                              </span>
                            </div>
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Employee
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Name
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Telephone
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Weight (lbs)
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Comments
                          </th>
                          <th className="border border-gray-300 p-2 text-left w-24">
                            Machine
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Price
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Paid
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Tip
                          </th>
                          <th
                            className="border border-gray-300 p-2 text-left cursor-pointer hover:bg-gray-700 transition-colors select-none w-32"
                            onClick={() => {
                              if (statusSortOrder === "none") {
                                setStatusSortOrder("asc");
                              } else if (statusSortOrder === "asc") {
                                setStatusSortOrder("desc");
                              } else {
                                setStatusSortOrder("asc");
                              }
                            }}
                            title="Click to sort by status workflow"
                          >
                            <div className="flex items-center gap-1">
                              Status
                              <span className="text-sm">
                                {statusSortOrder === "asc" ? "" : statusSortOrder === "desc" ? "" : ""}
                              </span>
                            </div>
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Pickup Date/Time
                          </th>
                          <th className="border border-gray-300 p-2 text-left">
                            Actions
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        {filteredRecords.map((record, index) => (
                          <tr
                            key={record.id}
                            className={
                              index % 2 === 0 ? "bg-gray-50" : "bg-white"
                            }
                          >
                            <td className="border border-gray-300 p-2 text-sm">
                              {record.dateTime}
                            </td>
                            <td className="border border-gray-300 p-2">
                              {record.employee}
                            </td>
                            <td className="border border-gray-300 p-2">
                              {record.name}
                            </td>
                            <td className="border border-gray-300 p-2">
                              {record.telephone}
                            </td>
                            <td className="border border-gray-300 p-2">
                              {record.weight || ""}
                            </td>
                            <td className="border border-gray-300 p-2 text-sm">
                              {record.comments || ""}
                            </td>
                            <td className="border border-gray-300 p-2 text-sm w-24">
                              {formatMachines(
                                record.washersUsed || [],
                                record.dryersUsed || []
                              )}
                            </td>
                            <td className="border border-gray-300 p-2">
                              ${record.price}
                            </td>
                            <td className="border border-gray-300 p-2">
                              ${record.paid || 0}
                            </td>
                            <td className="border border-gray-300 p-2">
                              ${record.tip || 0}
                            </td>
                            <td className="border border-gray-300 p-2 w-32">
                              <select
                                value={record.status}
                                onChange={(e) => handleStatusUpdate(record.id, e.target.value, record)}
                                className={`px-2 py-1 rounded text-xs font-medium border-none outline-none cursor-pointer w-full ${
                                  record.status === "Done"
                                    ? "bg-green-100 text-green-800"
                                    : record.status === "Picked Up"
                                    ? "bg-green-100 text-green-800"
                                    : "bg-yellow-100 text-yellow-800"
                                }`}
                              >
                                {statuses.map((status) => (
                                  <option key={status} value={status}>
                                    {status}
                                  </option>
                                ))}
                              </select>
                            </td>
                            <td className="border border-gray-300 p-2 text-center">
                              {record.pickupDateTime || "-"}
                            </td>
                            <td className="border border-gray-300 p-2">
                              <div className="flex gap-1">
                                <button
                                  onClick={() => handleEdit(record)}
                                  className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                  title="Edit"
                                >
                                  
                                </button>
                                <button
                                  onClick={() => handleDelete(record.id)}
                                  className="p-1 text-red-600 hover:bg-red-100 rounded"
                                  title="Delete"
                                >
                                  
                                </button>
                                {record.status === "Done" && (
                                  <button
                                    onClick={() =>
                                      sendSMSNotification(
                                        record.telephone,
                                        record.name
                                      )
                                    }
                                    className="p-1 text-green-600 hover:bg-green-100 rounded"
                                    title="Send SMS"
                                  >
                                    
                                  </button>
                                )}
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>

                    {filteredRecords.length === 0 && (
                      <div className="text-center py-8 text-gray-500">
                        {searchTerm
                          ? "No records found matching your search."
                          : "No laundry records yet."}
                      </div>
                    )}
                  </div>

                  <div className="mt-4 text-sm text-gray-600">
                    Total records: {filteredRecords.length}
                  </div>
                </div>
              )}

              {activeTab === "admin" && (
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-xl font-semibold mb-6">Admin Panel</h2>

                  {!adminAuthenticated ? (
                    <div className="max-w-md mx-auto">
                      <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6">
                        <h3 className="text-lg font-medium text-yellow-800 mb-4">
                           Authentication Required
                        </h3>
                        <p className="text-yellow-700 mb-4">
                          Please enter the admin passphrase to access this section.
                        </p>
                        <div className="space-y-4">
                          <input
                            type="password"
                            value={passphraseInput}
                            onChange={(e) => setPassphraseInput(e.target.value)}
                            onKeyPress={handlePassphraseKeyPress}
                            placeholder="Enter passphrase"
                            className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                          />
                          <button
                            onClick={handlePassphraseSubmit}
                            className="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-md font-medium transition-colors"
                          >
                            Access Admin Panel
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div>
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-lg font-medium text-gray-800">
                          Washer Pricing Configuration
                        </h3>
                        <div className="flex gap-2">
                          {!isEditingPrices ? (
                            <button
                              onClick={startEditingPrices}
                              className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Edit Prices
                            </button>
                          ) : (
                            <>
                              <button
                                onClick={savePriceChanges}
                                className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                              >
                                Save Changes
                              </button>
                              <button
                                onClick={cancelEditingPrices}
                                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                              >
                                Cancel
                              </button>
                            </>
                          )}
                          <button
                            onClick={() => setAdminAuthenticated(false)}
                            className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                          >
                            Logout
                          </button>
                        </div>
                      </div>

                      {/* Washers Section */}
                      <div className="mb-8">
                        <h4 className="text-lg font-medium text-gray-800 mb-4">Washers</h4>

                        {/* Add Washer Form */}
                        <div className="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                          <h5 className="text-md font-medium text-blue-800 mb-3">Add New Washer</h5>
                          <div className="flex gap-3 items-end">
                            <div>
                              <label className="block text-sm font-medium text-blue-700 mb-1">
                                Washer Number
                              </label>
                              <input
                                type="number"
                                value={newWasherNumber}
                                onChange={(e) => setNewWasherNumber(e.target.value)}
                                className="w-24 p-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="#"
                                min="1"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-blue-700 mb-1">
                                Price ($)
                              </label>
                              <input
                                type="number"
                                step="0.01"
                                value={newWasherPrice}
                                onChange={(e) => setNewWasherPrice(e.target.value)}
                                className="w-24 p-2 border border-blue-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="0.00"
                                min="0"
                              />
                            </div>
                            <button
                              onClick={addWasher}
                              className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Add Washer
                            </button>
                          </div>
                        </div>

                        {/* Delete Washers Section */}
                        <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                          <div className="flex justify-between items-center mb-3">
                            <h5 className="text-md font-medium text-red-800">Delete Washers</h5>
                            <button
                              onClick={deleteSelectedWashers}
                              disabled={selectedWashersToDelete.length === 0}
                              className="bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Delete Selected ({selectedWashersToDelete.length})
                            </button>
                          </div>
                          <p className="text-sm text-red-700 mb-3">Select washers to delete by clicking on them:</p>
                          <div className="flex flex-wrap gap-1">
                            {machineConfig.washers.active.map((washer) => (
                              <button
                                key={washer}
                                onClick={() => toggleWasherSelection(washer)}
                                className={`h-10 w-12 rounded border text-sm font-medium transition-colors ${
                                  selectedWashersToDelete.includes(washer)
                                    ? "bg-red-500 text-white border-red-500"
                                    : "bg-white text-gray-700 border-gray-300 hover:border-red-400"
                                }`}
                              >
                                W{washer}
                              </button>
                            ))}
                          </div>
                        </div>

                        {/* Washer Pricing Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                          {machineConfig.washers.active.map((washerNumber) => (
                            <div
                              key={washerNumber}
                              className="bg-gray-50 border border-gray-200 rounded-lg p-4"
                            >
                              <div className="text-center">
                                <h4 className="text-lg font-semibold text-gray-800 mb-2">
                                  Washer #{washerNumber}
                                </h4>
                                {isEditingPrices ? (
                                  <div className="flex items-center justify-center">
                                    <span className="text-lg font-bold text-blue-600 mr-1">$</span>
                                    <input
                                      type="number"
                                      step="0.01"
                                      min="0"
                                      value={tempPrices[washerNumber] !== undefined ? tempPrices[washerNumber] : (editablePrices[washerNumber] || 0)}
                                      onChange={(e) => handlePriceChange(washerNumber, e.target.value)}
                                      className="w-20 text-center text-lg font-bold text-blue-600 border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                  </div>
                                ) : (
                                  <div className="text-2xl font-bold text-blue-600">
                                    ${editablePrices[washerNumber] || 0}
                                  </div>
                                )}
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>

                      {/* Dryers Section */}
                      <div className="mb-8">
                        <h4 className="text-lg font-medium text-gray-800 mb-4">Dryers</h4>

                        {/* Add Dryer Form */}
                        <div className="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                          <h5 className="text-md font-medium text-green-800 mb-3">Add New Dryer</h5>
                          <div className="flex gap-3 items-end">
                            <div>
                              <label className="block text-sm font-medium text-green-700 mb-1">
                                Dryer Number
                              </label>
                              <input
                                type="number"
                                value={newDryerNumber}
                                onChange={(e) => setNewDryerNumber(e.target.value)}
                                className="w-24 p-2 border border-green-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                placeholder="#"
                                min="1"
                              />
                            </div>
                            <button
                              onClick={addDryer}
                              className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Add Dryer
                            </button>
                          </div>
                        </div>

                        {/* Delete Dryers Section */}
                        <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                          <div className="flex justify-between items-center mb-3">
                            <h5 className="text-md font-medium text-red-800">Delete Dryers</h5>
                            <button
                              onClick={deleteSelectedDryers}
                              disabled={selectedDryersToDelete.length === 0}
                              className="bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Delete Selected ({selectedDryersToDelete.length})
                            </button>
                          </div>
                          <p className="text-sm text-red-700 mb-3">Select dryers to delete by clicking on them:</p>
                          <div className="flex flex-wrap gap-1">
                            {machineConfig.dryers.active.map((dryer) => (
                              <button
                                key={dryer}
                                onClick={() => toggleDryerSelection(dryer)}
                                className={`h-10 w-12 rounded border text-sm font-medium transition-colors ${
                                  selectedDryersToDelete.includes(dryer)
                                    ? "bg-red-500 text-white border-red-500"
                                    : "bg-white text-gray-700 border-gray-300 hover:border-red-400"
                                }`}
                              >
                                D{dryer}
                              </button>
                            ))}
                          </div>
                        </div>
                      </div>

                      {/* Employees Section */}
                      <div className="mb-8">
                        <h4 className="text-lg font-medium text-gray-800 mb-4">Employee Management</h4>

                        {/* Add Employee Form */}
                        <div className="mb-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                          <h5 className="text-md font-medium text-purple-800 mb-3">Add New Employee</h5>
                          <div className="flex gap-3 items-end">
                            <div>
                              <label className="block text-sm font-medium text-purple-700 mb-1">
                                Employee Name
                              </label>
                              <input
                                type="text"
                                value={newEmployeeName}
                                onChange={(e) => setNewEmployeeName(e.target.value)}
                                onKeyPress={(e) => e.key === "Enter" && addEmployee()}
                                className="w-48 p-2 border border-purple-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                placeholder="Enter employee name"
                              />
                            </div>
                            <button
                              onClick={addEmployee}
                              className="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Add Employee
                            </button>
                          </div>
                        </div>

                        {/* Delete Employees Section */}
                        <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                          <div className="flex justify-between items-center mb-3">
                            <h5 className="text-md font-medium text-red-800">Delete Employees</h5>
                            <button
                              onClick={deleteSelectedEmployees}
                              disabled={selectedEmployeesToDelete.length === 0}
                              className="bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Delete Selected ({selectedEmployeesToDelete.length})
                            </button>
                          </div>
                          <p className="text-sm text-red-700 mb-3">Select employees to delete by clicking on them:</p>
                          <div className="flex flex-wrap gap-2">
                            {employees.map((employee) => (
                              <button
                                key={employee}
                                onClick={() => toggleEmployeeSelection(employee)}
                                className={`px-4 py-2 rounded-md border text-sm font-medium transition-colors ${
                                  selectedEmployeesToDelete.includes(employee)
                                    ? "bg-red-500 text-white border-red-500"
                                    : "bg-white text-gray-700 border-gray-300 hover:border-red-400"
                                }`}
                              >
                                {employee}
                              </button>
                            ))}
                          </div>
                        </div>

                        {/* Current Employees Display */}
                        <div className="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                          <h5 className="text-md font-medium text-gray-800 mb-3">Current Employees ({employees.length})</h5>
                          <div className="flex flex-wrap gap-2">
                            {employees.map((employee) => (
                              <span
                                key={employee}
                                className="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium"
                              >
                                {employee}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>

                      {/* Customer Database Section */}
                      <div className="mb-8">
                        <h4 className="text-lg font-medium text-gray-800 mb-4">Customer Database</h4>

                        {/* Search Bar */}
                        <div className="mb-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
                          <div className="flex items-center gap-2 mb-3">
                            <span className="text-gray-400"></span>
                            <input
                              type="text"
                              placeholder="Search customers by name or phone number..."
                              value={customerSearchTerm}
                              onChange={(e) => setCustomerSearchTerm(e.target.value)}
                              className="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                            <button
                              onClick={cleanupDuplicateCustomers}
                              className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md font-medium transition-colors text-sm"
                              title="Remove duplicate customer entries"
                            >
                               Clean Duplicates
                            </button>
                          </div>
                          <p className="text-sm text-gray-600">Total customers: {customerDatabase.length}</p>
                        </div>

                        {/* Add Customer Form */}
                        <div className="mb-4 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                          <h5 className="text-md font-medium text-orange-800 mb-3">Add New Customer</h5>
                          <div className="flex gap-3 items-end flex-wrap">
                            <div>
                              <label className="block text-sm font-medium text-orange-700 mb-1">
                                Customer Name
                              </label>
                              <input
                                type="text"
                                value={newCustomerName}
                                onChange={(e) => setNewCustomerName(e.target.value)}
                                onKeyPress={(e) => e.key === "Enter" && addCustomer()}
                                className="w-48 p-2 border border-orange-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                placeholder="Enter customer name"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-orange-700 mb-1">
                                Phone Number (Optional)
                              </label>
                              <input
                                type="tel"
                                value={newCustomerPhone}
                                onChange={(e) => setNewCustomerPhone(e.target.value)}
                                onKeyPress={(e) => e.key === "Enter" && addCustomer()}
                                className="w-48 p-2 border border-orange-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                placeholder="Enter phone number"
                              />
                            </div>
                            <button
                              onClick={addCustomer}
                              className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Add Customer
                            </button>
                          </div>
                        </div>

                        {/* Delete Customers Section */}
                        <div className="mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                          <div className="flex justify-between items-center mb-3">
                            <h5 className="text-md font-medium text-red-800">Delete Customers</h5>
                            <button
                              onClick={deleteSelectedCustomers}
                              disabled={selectedCustomersToDelete.length === 0}
                              className="bg-red-500 hover:bg-red-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-md font-medium transition-colors"
                            >
                              Delete Selected ({selectedCustomersToDelete.length})
                            </button>
                          </div>
                          <p className="text-sm text-red-700 mb-3">Select customers to delete by clicking the checkboxes in the table below.</p>
                        </div>

                        {/* Customer List Table */}
                        <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                          <h5 className="text-md font-medium text-gray-800 mb-3">Customer List</h5>
                          {getFilteredCustomers().length > 0 ? (
                            <div className="overflow-x-auto">
                              <table className="w-full border-collapse border border-gray-300">
                                <thead>
                                  <tr className="bg-gray-200">
                                    <th className="border border-gray-300 p-2 text-left">
                                      <input
                                        type="checkbox"
                                        checked={selectedCustomersToDelete.length === getFilteredCustomers().length && getFilteredCustomers().length > 0}
                                        onChange={(e) => {
                                          if (e.target.checked) {
                                            setSelectedCustomersToDelete(getFilteredCustomers().map(c => c.id));
                                          } else {
                                            setSelectedCustomersToDelete([]);
                                          }
                                        }}
                                        className="mr-2"
                                      />
                                      Select
                                    </th>
                                    <th className="border border-gray-300 p-2 text-left">Name</th>
                                    <th className="border border-gray-300 p-2 text-left">Phone Number</th>
                                    <th className="border border-gray-300 p-2 text-left">Actions</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {getFilteredCustomers().map((customer, index) => (
                                    <tr
                                      key={customer.id}
                                      className={index % 2 === 0 ? "bg-white" : "bg-gray-50"}
                                    >
                                      <td className="border border-gray-300 p-2">
                                        <input
                                          type="checkbox"
                                          checked={selectedCustomersToDelete.includes(customer.id)}
                                          onChange={() => toggleCustomerSelection(customer.id)}
                                          className="mr-2"
                                        />
                                      </td>
                                      <td className="border border-gray-300 p-2">
                                        {editingCustomerId === customer.id ? (
                                          <input
                                            type="text"
                                            value={editCustomerName}
                                            onChange={(e) => setEditCustomerName(e.target.value)}
                                            className="w-full p-1 border border-gray-300 rounded"
                                          />
                                        ) : (
                                          customer.name
                                        )}
                                      </td>
                                      <td className="border border-gray-300 p-2">
                                        {editingCustomerId === customer.id ? (
                                          <input
                                            type="tel"
                                            value={editCustomerPhone}
                                            onChange={(e) => setEditCustomerPhone(e.target.value)}
                                            className="w-full p-1 border border-gray-300 rounded"
                                          />
                                        ) : (
                                          customer.telephone || "N/A"
                                        )}
                                      </td>
                                      <td className="border border-gray-300 p-2">
                                        <div className="flex gap-1">
                                          {editingCustomerId === customer.id ? (
                                            <>
                                              <button
                                                onClick={saveCustomerChanges}
                                                className="p-1 text-green-600 hover:bg-green-100 rounded"
                                                title="Save"
                                              >
                                                
                                              </button>
                                              <button
                                                onClick={cancelEditingCustomer}
                                                className="p-1 text-gray-600 hover:bg-gray-100 rounded"
                                                title="Cancel"
                                              >
                                                
                                              </button>
                                            </>
                                          ) : (
                                            <button
                                              onClick={() => startEditingCustomer(customer)}
                                              className="p-1 text-blue-600 hover:bg-blue-100 rounded"
                                              title="Edit"
                                            >
                                              
                                            </button>
                                          )}
                                        </div>
                                      </td>
                                    </tr>
                                  ))}
                                </tbody>
                              </table>
                            </div>
                          ) : (
                            <div className="text-center py-8 text-gray-500">
                              {customerSearchTerm
                                ? "No customers found matching your search."
                                : "No customers in database yet."}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      };

      ReactDOM.render(
        <LaundryManagementApp />,
        document.getElementById("root")
      );
    </script>
  </body>
</html>
